# Quiz Daily - 일일 퀴즈 관리 워크플로우

퀴즈 데이터의 일일 점검 및 관리 작업을 순차적으로 수행합니다.
각 단계는 검증을 거치며, 실패 시 즉시 중단하고 오류를 보고합니다.

## 입력 파라미터

- **실행 모드**: $ARGUMENTS
- `full` - 전체 워크플로우 실행 (기본값)
- `check` - 검증만 수행 (1-4단계)
- `backup` - 백업만 수행 (6단계)
- 숫자 - 특정 단계만 실행 (예: "3"은 3단계만)

## 워크플로우 단계

---

### 📋 Step 1: 파일 구조 읽기 및 이해

**목적**: 퀴즈 파일의 구조를 파악하고 정상 여부 확인

**수행 작업**:
1. `quiz-master/questions.js` 파일 읽기
2. `datasci-trivia/questions.js` 파일 읽기
3. 각 파일의 데이터 구조 검증
   - JavaScript 객체 문법 유효성
   - 필수 필드 존재 여부 (question, options, correct/answer)
   - 배열 구조 확인

**검증 조건**:
- [ ] quiz-master/questions.js 파일 존재 및 읽기 가능
- [ ] datasci-trivia/questions.js 파일 존재 및 읽기 가능
- [ ] 두 파일 모두 유효한 JavaScript 객체 구조

**실패 시**: `[ERROR] Step 1 실패: 파일 구조 오류 - {오류 상세}`

---

### 📊 Step 2: 현재 문제 개수와 분포 확인

**목적**: 전체 퀴즈 현황 파악

**수행 작업**:
1. 총 문제 수 계산
2. 파일별 문제 수 집계
3. 카테고리별 문제 수 집계
4. 난이도별 문제 수 집계 (datasci-trivia)
5. 정답 분포 분석

**출력 형식**:
```
[Step 2] 현재 문제 분포
━━━━━━━━━━━━━━━━━━━━━━━━
총 문제 수: N개

quiz-master (N개):
  - general: N개
  - science: N개
  - history: N개
  - geography: N개

datasci-trivia (N개):
  - ml: easy(N) / medium(N) / hard(N)
  - stats: easy(N) / medium(N) / hard(N)
  - python: easy(N) / medium(N) / hard(N)
  - data: easy(N) / medium(N) / hard(N)

정답 분포: 0(N%) / 1(N%) / 2(N%) / 3(N%)
```

**검증 조건**:
- [ ] 모든 카테고리에 최소 1개 이상의 문제 존재
- [ ] 정답 분포가 극단적으로 치우치지 않음 (각 위치 15-35%)

**실패 시**: `[ERROR] Step 2 실패: 문제 분포 이상 - {상세 내용}`

---

### 🔍 Step 3: 카테고리별 부족한 부분 파악

**목적**: 보강이 필요한 영역 식별

**수행 작업**:
1. 카테고리별 목표 문제 수와 비교
   - quiz-master: 각 카테고리 10문제 이상
   - datasci-trivia: 각 난이도 5문제 이상
2. 정답 위치별 불균형 분석
3. 문제 길이/난이도 분포 분석
4. 개선 필요 항목 목록화

**출력 형식**:
```
[Step 3] 부족한 부분 분석
━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 보강 필요:
  - [카테고리]: N개 부족 (현재 N개 / 목표 N개)
  - [카테고리/난이도]: 정답 위치 N번 부족

✅ 양호:
  - [카테고리]: 목표 달성
```

**검증 조건**:
- [ ] 분석 완료

**실패 시**: `[ERROR] Step 3 실패: 분석 오류 - {상세 내용}`

---

### 🔄 Step 4: 중복 체크

**목적**: 새 문제 추가 전 기존 문제와의 중복 확인

**수행 작업**:
1. 모든 문제의 question 필드 추출
2. 완전 일치 중복 검사
3. 유사도 검사 (80% 이상 유사한 문제)
4. 정답-선택지 조합 중복 검사

**출력 형식**:
```
[Step 4] 중복 검사 결과
━━━━━━━━━━━━━━━━━━━━━━━━
검사 문제 수: N개

완전 중복: N건
  - "문제1" (위치1 ↔ 위치2)

유사 문제: N건
  - "문제1" ↔ "문제2" (유사도: N%)

✅ 중복 없음 / ⚠️ 중복 발견
```

**검증 조건**:
- [ ] 완전 중복 문제 없음
- [ ] 유사도 90% 이상 문제 없음

**실패 시**: `[ERROR] Step 4 실패: 중복 발견 - {중복 문제 목록}`

---

### ✅ Step 5: 형식 검증

**목적**: 문제 추가 후 전체 데이터 형식 검증

**수행 작업**:
1. 모든 문제의 필수 필드 검증
   - question: 문자열, 비어있지 않음
   - options: 4개 요소 배열
   - correct/answer: 0-3 범위 정수
   - explanation: 문자열 (quiz-master만)
2. 모호한 표현 검사 (quiz-validate 규칙 적용)
3. 선택지 품질 검사
   - 중복 선택지 없음
   - 빈 선택지 없음

**출력 형식**:
```
[Step 5] 형식 검증 결과
━━━━━━━━━━━━━━━━━━━━━━━━
검증 항목:
  ✅ 필수 필드: 통과 (N/N)
  ✅ 정답 인덱스: 통과 (N/N)
  ⚠️ 모호한 표현: N건 발견
  ✅ 선택지 품질: 통과 (N/N)

모호한 표현 목록:
  - [카테고리] "문제" → "가장" 발견
```

**검증 조건**:
- [ ] 필수 필드 검증 100% 통과
- [ ] 정답 인덱스 모두 유효
- [ ] 선택지 품질 검증 통과

**실패 시**: `[ERROR] Step 5 실패: 형식 오류 - {오류 목록}`

---

### 💾 Step 6: 전체 데이터 백업

**목적**: 현재 상태의 퀴즈 데이터 백업

**수행 작업**:
1. 백업 디렉토리 확인/생성 (`backups/`)
2. 타임스탬프 포함 백업 파일 생성
3. 백업 파일 무결성 검증
4. 오래된 백업 정리 안내 (30일 이상)

**백업 파일명 형식**:
```
backups/
  ├── quiz-master_YYYYMMDD_HHMMSS.js
  └── datasci-trivia_YYYYMMDD_HHMMSS.js
```

**출력 형식**:
```
[Step 6] 백업 완료
━━━━━━━━━━━━━━━━━━━━━━━━
백업 위치: backups/
생성된 파일:
  - quiz-master_20240101_120000.js (N KB)
  - datasci-trivia_20240101_120000.js (N KB)

기존 백업: N개
```

**검증 조건**:
- [ ] 백업 파일 생성 성공
- [ ] 백업 파일 크기 > 0
- [ ] 백업 파일 읽기 가능

**실패 시**: `[ERROR] Step 6 실패: 백업 오류 - {오류 상세}`

---

### 📝 Step 7: 실행 결과 상세 보고

**목적**: 전체 워크플로우 실행 결과 종합 보고

**출력 형식**:
```
═══════════════════════════════════════════
       📊 Quiz Daily 실행 결과 보고서
═══════════════════════════════════════════

실행 시간: YYYY-MM-DD HH:MM:SS
실행 모드: [full/check/backup]

┌─────────────────────────────────────────┐
│ 단계별 실행 결과                          │
├──────┬──────────────────┬───────────────┤
│ 단계 │ 작업              │ 결과          │
├──────┼──────────────────┼───────────────┤
│  1   │ 파일 구조 읽기    │ ✅ 성공       │
│  2   │ 문제 분포 확인    │ ✅ 성공       │
│  3   │ 부족 부분 파악    │ ✅ 성공       │
│  4   │ 중복 체크         │ ✅ 성공       │
│  5   │ 형식 검증         │ ⚠️ 경고 N건   │
│  6   │ 데이터 백업       │ ✅ 성공       │
│  7   │ 결과 보고         │ ✅ 성공       │
└──────┴──────────────────┴───────────────┘

📈 요약:
  - 총 문제: N개
  - 신규 추가: N개
  - 발견된 이슈: N건
  - 백업 완료: ✅

⚠️ 주의 사항:
  - [개선이 필요한 항목들]

📋 다음 작업 권장:
  - [권장 후속 작업들]

═══════════════════════════════════════════
```

---

## 오류 처리

### 즉시 중단 조건
- 파일 읽기/쓰기 실패
- 필수 필드 누락
- 완전 중복 문제 발견
- 백업 실패

### 경고 후 계속 조건
- 모호한 표현 발견
- 정답 분포 불균형
- 유사 문제 발견 (90% 미만)

### 오류 보고 형식
```
[FATAL] 워크플로우 중단
━━━━━━━━━━━━━━━━━━━━━━━━
중단 단계: Step N
오류 유형: {오류 유형}
오류 내용: {상세 내용}

마지막 성공 단계: Step N-1
롤백 필요: [예/아니오]

복구 방법:
  1. {복구 단계 1}
  2. {복구 단계 2}
```

## 사용 예시

```
/project:quiz-daily              # 전체 워크플로우 실행
/project:quiz-daily full         # 전체 워크플로우 실행
/project:quiz-daily check        # 검증만 수행 (1-4단계)
/project:quiz-daily backup       # 백업만 수행
/project:quiz-daily 3            # 3단계만 실행
```

## 권장 실행 주기

- **매일**: `check` 모드로 데이터 상태 확인
- **문제 추가 시**: `full` 모드로 전체 검증
- **주간**: `backup` 모드로 정기 백업
